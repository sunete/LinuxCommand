
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
    <meta name="description" content="ethtool:显示或修改以太网卡的配置信息 - 最专业的Linux命令大全，内容包含Linux命令手册、详解、学习，值得收藏的Linux命令速查手册。">
    <meta name="keywords" content="Linux,Command,命令大全,Linux命令手册,ethtool,显示或修改以太网卡的配置信息">
    <title>ethtool 命令，Linux ethtool 命令详解：显示或修改以太网卡的配置信息 -  Linux 命令搜索引擎</title>
    <link rel="shortcut icon" href="../img/favicon.ico">
    <link rel="stylesheet" type="text/css" href="../css/index.css?v=1628823324752">
</head>
<body>

<div class="header header_list">
    <div class="search">
        <ul class="search-list" id="result">
            <!-- <li><a href="#"><strong>find</strong> - 指定目录下查找文件。</a></li> -->
        </ul>
        <input type="text" class="query" id="query" autocomplete="off" autofocus="autofocus" placeholder="Linux 命令搜索"/>
        <div class="enter-input">
            <input type="hidden" id="current_path" value="/c/ethtool.html">
            <button id="search_btn">搜索</button>
        </div>
    </div>
</div>

<div class="markdown-body">

<span class="edit_btn">

<span class="split"></span>

</span>

<h1 id="ethtool"><a href="#ethtool" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>ethtool</h1>
<p>显示或修改以太网卡的配置信息</p>
<h2 id="补充说明"><a href="#%E8%A1%A5%E5%85%85%E8%AF%B4%E6%98%8E" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>补充说明</h2>
<p>ethtool命令用于获取以太网卡的配置信息，或者修改这些配置。这个命令比较复杂，功能特别多。</p>
<h3 id="语法"><a href="#%E8%AF%AD%E6%B3%95" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>语法</h3>
<pre class="language-shell"><code class="language-shell"><span class="token function">ethtool</span> <span class="token punctuation">[</span> -a <span class="token operator">|</span> -c <span class="token operator">|</span> -g <span class="token operator">|</span> -i <span class="token operator">|</span> -d <span class="token operator">|</span> -k <span class="token operator">|</span> -r <span class="token operator">|</span> -S <span class="token operator">|</span><span class="token punctuation">]</span> ethX
<span class="token function">ethtool</span> <span class="token punctuation">[</span>-A<span class="token punctuation">]</span> ethX <span class="token punctuation">[</span>autoneg on<span class="token operator">|</span>off<span class="token punctuation">]</span> <span class="token punctuation">[</span>rx on<span class="token operator">|</span>off<span class="token punctuation">]</span> <span class="token punctuation">[</span>tx on<span class="token operator">|</span>off<span class="token punctuation">]</span>
<span class="token function">ethtool</span> <span class="token punctuation">[</span>-C<span class="token punctuation">]</span> ethX <span class="token punctuation">[</span>adaptive-rx on<span class="token operator">|</span>off<span class="token punctuation">]</span> <span class="token punctuation">[</span>adaptive-tx on<span class="token operator">|</span>off<span class="token punctuation">]</span> <span class="token punctuation">[</span>rx-usecs N<span class="token punctuation">]</span> <span class="token punctuation">[</span>rx-frames N<span class="token punctuation">]</span> <span class="token punctuation">[</span>rx-usecs-irq N<span class="token punctuation">]</span> <span class="token punctuation">[</span>rx-frames-irq N<span class="token punctuation">]</span> <span class="token punctuation">[</span>tx-usecs N<span class="token punctuation">]</span> <span class="token punctuation">[</span>tx-frames N<span class="token punctuation">]</span> <span class="token punctuation">[</span>tx-usecs-irq N<span class="token punctuation">]</span> <span class="token punctuation">[</span>tx-frames-irq N<span class="token punctuation">]</span> <span class="token punctuation">[</span>stats-block-usecs N<span class="token punctuation">]</span><span class="token punctuation">[</span>pkt-rate-low N<span class="token punctuation">]</span><span class="token punctuation">[</span>rx-usecs-low N<span class="token punctuation">]</span> <span class="token punctuation">[</span>rx-frames-low N<span class="token punctuation">]</span> <span class="token punctuation">[</span>tx-usecs-low N<span class="token punctuation">]</span> <span class="token punctuation">[</span>tx-frames-lowN<span class="token punctuation">]</span> <span class="token punctuation">[</span>pkt-rate-high N<span class="token punctuation">]</span> <span class="token punctuation">[</span>rx-usecs-high N<span class="token punctuation">]</span> <span class="token punctuation">[</span>rx-frames-high N<span class="token punctuation">]</span> <span class="token punctuation">[</span>tx-usecs-high N<span class="token punctuation">]</span> <span class="token punctuation">[</span>tx-frames-high N<span class="token punctuation">]</span> <span class="token punctuation">[</span>sample-interval N<span class="token punctuation">]</span>
<span class="token function">ethtool</span> <span class="token punctuation">[</span>-G<span class="token punctuation">]</span> ethX <span class="token punctuation">[</span>rx N<span class="token punctuation">]</span> <span class="token punctuation">[</span>rx-mini N<span class="token punctuation">]</span> <span class="token punctuation">[</span>rx-jumbo N<span class="token punctuation">]</span> <span class="token punctuation">[</span>tx N<span class="token punctuation">]</span>
<span class="token function">ethtool</span> <span class="token punctuation">[</span>-e<span class="token punctuation">]</span> ethX <span class="token punctuation">[</span>raw on<span class="token operator">|</span>off<span class="token punctuation">]</span> <span class="token punctuation">[</span>offset N<span class="token punctuation">]</span> <span class="token punctuation">[</span>length N<span class="token punctuation">]</span>
<span class="token function">ethtool</span> <span class="token punctuation">[</span>-E<span class="token punctuation">]</span> ethX <span class="token punctuation">[</span>magic N<span class="token punctuation">]</span> <span class="token punctuation">[</span>offset N<span class="token punctuation">]</span> <span class="token punctuation">[</span>value N<span class="token punctuation">]</span>
<span class="token function">ethtool</span> <span class="token punctuation">[</span>-K<span class="token punctuation">]</span> ethX <span class="token punctuation">[</span>rx on<span class="token operator">|</span>off<span class="token punctuation">]</span> <span class="token punctuation">[</span>tx on<span class="token operator">|</span>off<span class="token punctuation">]</span> <span class="token punctuation">[</span>sg on<span class="token operator">|</span>off<span class="token punctuation">]</span> <span class="token punctuation">[</span>tso on<span class="token operator">|</span>off<span class="token punctuation">]</span>
<span class="token function">ethtool</span> <span class="token punctuation">[</span>-p<span class="token punctuation">]</span> ethX <span class="token punctuation">[</span>N<span class="token punctuation">]</span>
<span class="token function">ethtool</span> <span class="token punctuation">[</span>-t<span class="token punctuation">]</span> ethX <span class="token punctuation">[</span>offline<span class="token operator">|</span>online<span class="token punctuation">]</span>
<span class="token function">ethtool</span> <span class="token punctuation">[</span>-s<span class="token punctuation">]</span> ethX <span class="token punctuation">[</span>speed <span class="token number">10</span><span class="token operator">|</span><span class="token number">100</span><span class="token operator">|</span><span class="token number">1000</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>duplex half<span class="token operator">|</span>full<span class="token punctuation">]</span> <span class="token punctuation">[</span>autoneg on<span class="token operator">|</span>off<span class="token punctuation">]</span> <span class="token punctuation">[</span>port tp<span class="token operator">|</span>aui<span class="token operator">|</span>bnc<span class="token operator">|</span>mii<span class="token punctuation">]</span> <span class="token punctuation">[</span>phyad N<span class="token punctuation">]</span> <span class="token punctuation">[</span>xcvr internal<span class="token operator">|</span>external<span class="token punctuation">]</span>
<span class="token punctuation">[</span>wol p<span class="token operator">|</span>u<span class="token operator">|</span>m<span class="token operator">|</span>b<span class="token operator">|</span>a<span class="token operator">|</span>g<span class="token operator">|</span>s<span class="token operator">|</span>d<span class="token punctuation">..</span>.<span class="token punctuation">]</span> <span class="token punctuation">[</span>sopass xx:yy:zz:aa:bb:cc<span class="token punctuation">]</span> <span class="token punctuation">[</span>msglvl N<span class="token punctuation">]</span>
</code></pre>
<h3 id="选项"><a href="#%E9%80%89%E9%A1%B9" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>选项</h3>
<pre class="language-shell"><code class="language-shell">-a 查看网卡中 接收模块RX、发送模块TX和Autonegotiate模块的状态：启动on 或 停用off。
-A 修改网卡中 接收模块RX、发送模块TX和Autonegotiate模块的状态：启动on 或 停用off。
-c display the Coalesce information of the specified ethernet card。
-C Change the Coalesce setting of the specified ethernet card。
-g Display the rx/tx ring parameter information of the specified ethernet card。
-G change the rx/tx ring setting of the specified ethernet card。
-i 显示网卡驱动的信息，如驱动的名称、版本等。
-d 显示register dump信息, 部分网卡驱动不支持该选项。
-e 显示EEPROM dump信息，部分网卡驱动不支持该选项。
-E 修改网卡EEPROM byte。
-k 显示网卡Offload参数的状态：on 或 off，包括rx-checksumming、tx-checksumming等。
-K 修改网卡Offload参数的状态。
-p 用于区别不同ethX对应网卡的物理位置，常用的方法是使网卡port上的led不断的闪；N指示了网卡闪的持续时间，以秒为单位。
-r 如果auto-negotiation模块的状态为on，则restarts auto-negotiation。
-S 显示NIC- and driver-specific 的统计参数，如网卡接收/发送的字节数、接收/发送的广播包个数等。
-t 让网卡执行自我检测，有两种模式：offline or online。
-s 修改网卡的部分配置，包括网卡速度、单工/全双工模式、mac地址等。
</code></pre>
<h3 id="数据来源"><a href="#%E6%95%B0%E6%8D%AE%E6%9D%A5%E6%BA%90" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>数据来源</h3>
<p>Ethtool命令显示的信息来源于网卡驱动层，即TCP/ip协议的链路层。该命令在Linux内核中实现的逻辑层次为：</p>
<p>最重要的结构体<code>struct ethtool_ops</code>，该结构体成员为用于显示或修改以太网卡配置的一系列函数指针，见下表中的第二列。</p>
<p>网卡驱动负责实现（部分）这些函数，并将其封装入<code>ethtool_ops</code>结构体，为网络核心层提供统一的调用接口。因此，不同的网卡驱动会给应用层返回不同的信息。<code>Ethtool命令选项</code>、<code>struct ethtool_ops成员函数</code>、<code>Ethtool命令显示参数的来源</code>，三者间的对应关系如下表所示：</p>
<table>
<tbody>
<tr>
<th style="width: 100px;">命令选项</th>
<th>struct ethtool_ops成员函数</th>
<th>Ethtool命令显示参数的来源（以网卡驱动BNX2为例）</th></tr>
<tr>
<td>无 -s</td>
<td>get_settingsget_wol get_msglevel get_link set_settings set_wol set_msglevel</td>
<td>从网卡寄存器中获得网卡速度等信息，可配置。</td>
</tr>
<tr>
<td>-a -A</td>
<td>get_pauseparam set_pauseparam</td>
<td>从网卡寄存器中获得Autonegotiate/RX/TX模块的状态：on oroff，可配置。</td>
</tr>
<tr>
<td>-c -C</td>
<td>get_coalesceset_coalesce</td>
<td>从网卡寄存器中获得coalescing参数：TX/RX一个数据包后，推迟发生TX/RX中断的时间(us)/数据包个数。—减小该值可以提高网卡的响应时间。 当rx-usecs&#x26;rx-frames同时被设为0时，RX中断停止。 当tx-usecs&#x26;tx-frames同时被设为0时，TX中断停止。</td>
</tr>
<tr>
<td>-g -G</td>
<td>get_ringparam set_ringparam</td>
<td>除当前TX/RX ring的值（从网卡寄存器中读取得到，可配置）外，其它为网卡bnx2自己固定的信息。</td>
</tr>
<tr>
<td>-k -K</td>
<td>get_rx_csumget_tx_csum get_sg get_tso set_rx_csum set_tx_csum set_sg set_tso</td>
<td>显示信息从保存该状态的变量中读取得到，没有对应的寄存器。因此，TX/RX校验等模块一直处于on状态，实际上是无法修改的。</td>
</tr>
<tr>
<td>-i</td>
<td>get_drvinfo[self_test_count, get_stats_coun,t get_regs_len, get_eeprom_len]</td>
<td>网卡bnx2自己固定的信息，如：  
——————————————————–  
driver: bnx2 version: 1.4.30 firmware-version: 1.8.0.5 bus-info: 0000:09:00.0  
——————————————————–</td>
</tr>
<tr>
<td>-d</td>
<td>get_drvinfoget_regs</td>
<td>不支持，即bnx2中没有实现函数get_regs。</td>
</tr>
<tr>
<td>-e -E</td>
<td>get_eepromset_eeprom</td>
<td>不支持，即bnx2中没有实现函数get_eeprom。</td>
</tr>
<tr>
<td>-r</td>
<td>nway_reset</td>
<td>配置网卡MII_BMCR寄存器，重启Auto negotiation模块。</td>
</tr>
<tr>
<td>-p</td>
<td>phys_id</td>
<td>配置网卡BNX2_EMAC_LED寄存器，实现LED闪功能。</td>
</tr>
<tr>
<td>-t</td>
<td>self_test</td>
<td>通过配置网卡寄存器，逐一测试网卡的硬件模块：registers，memory，loopback，Link stat，interrupt。</td>
</tr>
<tr>
<td>-S</td>
<td>get_ethtool_stats</td>
<td>显示信息来源于网卡驱动中的结构体变量stats_blk。（网卡通过DMA方式，将寄存器BNX2_HC_STATISTICS _ADDR_L和BNX2_HC_STATISTICS_ADDR_H中的数据实时地读取到结构体变量struct statistics_block *stats_blk中。） —显示的数据都是从网卡寄存器中统计得到的，各项的含义需查询网卡（芯片）手册。</td>
</tr>
</tbody>
</table>
<p>由上可见，ethtool命令用于显示/配置网卡硬件（寄存器）。  </p>
<h3 id="实例"><a href="#%E5%AE%9E%E4%BE%8B" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>实例</h3>
<p>查看机器上网卡的速度：百兆还是千兆，请输入：</p>
<pre class="language-shell"><code class="language-shell">ethool eth0
</code></pre>
<p>操作完毕后，输出信息中<code>Speed:</code>这一项就指示了网卡的速度。停止网卡的发送模块TX，请输入：</p>
<pre class="language-shell"><code class="language-shell"><span class="token function">ethtool</span> -A tx off eth0
</code></pre>
<p>操作完毕后，可输入<code>ethtool -a eth0</code>，查看tx模块是否已被停止。查看网卡eth0采用了何种驱动，请输入：</p>
<pre class="language-shell"><code class="language-shell"><span class="token function">ethtool</span> -i eth0
</code></pre>
<p>操作完毕后，显示 driver: bnx2；version: 1.4.30 等信息。关闭网卡对收到的数据包的校验功能，请输入：</p>
<pre class="language-shell"><code class="language-shell"><span class="token function">ethtool</span> -K eth0 rx off
</code></pre>
<p>操作完毕后，可输入<code>ethtool –k eth0</code>，查看校验功能是否已被停止。如果机器上安装了两块网卡，那么eth0对应着哪块网卡呢？输入：</p>
<pre class="language-shell"><code class="language-shell"><span class="token function">ethtool</span> -p eth0 <span class="token number">10</span>
</code></pre>
<p>操作完毕后，看哪块网卡的led灯在闪，eth0就对应着哪块网卡。查看网卡，在接收/发送数据时，有没有出错？请输入：</p>
<pre class="language-shell"><code class="language-shell"><span class="token function">ethtool</span> –S eth0
</code></pre>
<p>将千兆网卡的速度降为百兆，请输入：</p>
<pre class="language-shell"><code class="language-shell"><span class="token function">ethtool</span> -s eth0 speed <span class="token number">100</span>
</code></pre>
<!-- Linux命令行搜索引擎：https://jaywcjlove.github.io/linux-command/ -->
</div>

<div class="footer  footer_index "><a href="../hot.html">Linux 命令列表</a></div><script type="text/javascript" src="../js/dt.js?v=1628823324531"></script><script type="text/javascript" src="../js/index.js?v=1628823324531"></script></body></html>